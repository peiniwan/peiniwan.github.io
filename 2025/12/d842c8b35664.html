

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="å…­æœˆçš„é›¨">
  <meta name="keywords" content="">
  
    <meta name="description" content="è¿›ç¨‹é—´é€šä¿¡(ipc)[[7-Webviewå¤šè¿›ç¨‹æ–¹æ¡ˆ]] IPCçš„ä¸»è¦ç›®çš„æ˜¯è°ƒç”¨å…¶ä»–è¿›ç¨‹çš„å‡½æ•°  ä½¿ç”¨å¤šè¿›ç¨‹æ˜¾è€Œæ˜“è§çš„å¥½å¤„å°±æ˜¯åˆ†æ‹…ä¸»è¿›ç¨‹çš„å†…å­˜å‹åŠ›ã€‚æˆ‘ä»¬çš„åº”ç”¨è¶Šåšè¶Šå¤§ï¼Œå†…å­˜è¶Šæ¥è¶Šå¤šï¼Œå°†ä¸€äº›ç‹¬ç«‹çš„ç»„ä»¶æ”¾åˆ°ä¸åŒçš„è¿›ç¨‹ï¼Œå®ƒå°±ä¸å ç”¨ä¸»è¿›ç¨‹çš„å†…å­˜ç©ºé—´äº†ã€‚å½“ç„¶è¿˜æœ‰å…¶ä»–å¥½å¤„ï¼Œæœ‰äº›åº”ç”¨åå°æ˜¯æœ‰å¤šä¸ªè¿›ç¨‹çš„ï¼Œå¯åŠ¨ä¸€ä¸ªä¸å¯è§çš„è½»é‡çº§ç§æœ‰è¿›ç¨‹ï¼Œåœ¨åå°æ”¶å‘æ¶ˆæ¯ï¼Œæˆ–è€…åšä¸€äº›è€—æ—¶çš„äº‹æƒ…ï¼Œæˆ–è€…å¼€æœºå¯åŠ¨è¿™ä¸ªè¿›ç¨‹ï¼Œç„¶ååšç›‘å¬ç­‰ã€‚è¿˜æœ‰">
<meta property="og:type" content="article">
<meta property="og:title" content="å¤šè¿›ç¨‹Binder">
<meta property="og:url" content="http://peiniwan.github.io/2025/12/d842c8b35664.html">
<meta property="og:site_name" content="å…­æœˆçš„é›¨çš„ç¬”è®°">
<meta property="og:description" content="è¿›ç¨‹é—´é€šä¿¡(ipc)[[7-Webviewå¤šè¿›ç¨‹æ–¹æ¡ˆ]] IPCçš„ä¸»è¦ç›®çš„æ˜¯è°ƒç”¨å…¶ä»–è¿›ç¨‹çš„å‡½æ•°  ä½¿ç”¨å¤šè¿›ç¨‹æ˜¾è€Œæ˜“è§çš„å¥½å¤„å°±æ˜¯åˆ†æ‹…ä¸»è¿›ç¨‹çš„å†…å­˜å‹åŠ›ã€‚æˆ‘ä»¬çš„åº”ç”¨è¶Šåšè¶Šå¤§ï¼Œå†…å­˜è¶Šæ¥è¶Šå¤šï¼Œå°†ä¸€äº›ç‹¬ç«‹çš„ç»„ä»¶æ”¾åˆ°ä¸åŒçš„è¿›ç¨‹ï¼Œå®ƒå°±ä¸å ç”¨ä¸»è¿›ç¨‹çš„å†…å­˜ç©ºé—´äº†ã€‚å½“ç„¶è¿˜æœ‰å…¶ä»–å¥½å¤„ï¼Œæœ‰äº›åº”ç”¨åå°æ˜¯æœ‰å¤šä¸ªè¿›ç¨‹çš„ï¼Œå¯åŠ¨ä¸€ä¸ªä¸å¯è§çš„è½»é‡çº§ç§æœ‰è¿›ç¨‹ï¼Œåœ¨åå°æ”¶å‘æ¶ˆæ¯ï¼Œæˆ–è€…åšä¸€äº›è€—æ—¶çš„äº‹æƒ…ï¼Œæˆ–è€…å¼€æœºå¯åŠ¨è¿™ä¸ªè¿›ç¨‹ï¼Œç„¶ååšç›‘å¬ç­‰ã€‚è¿˜æœ‰">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-d535d118941b2ce613d96a00372c86b5-unknown_filename.12-47e09f.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-21161fa4518997147db59bd538a79188-unknown_filename.3-11cf0f.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-d535d118941b2ce613d96a00372c86b5-unknown_filename.12-47e09f.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-b0a684a7ade4b9dcbfe5d57315147ab6-unknown_filename-389477.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-7a752757f78b00d53af8a44434318362-unknown_filename.1-cad1b1.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-42c476195f8b467a65124b26e57e4978-unknown_filename.2-5f90d1.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-d772d3e8ddede1b16cb9d97bc67c5849-unknown_filename.8-d4944c.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/09/15/2024-02-27-17-32-0b27ffc6ca61560ee597113bd4cf43ca-18-50-43-0b27ffc6ca61560ee597113bd4cf43ca-unknown_filename.7-0448c0-598490.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/09/15/2024-02-27-17-31-059823902e225e7587438407a9672fe5-18-50-43-059823902e225e7587438407a9672fe5-unknown_filename.4-d31a09-940e82.png">
<meta property="og:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-c8625b252f78ea946bc9408ae352c0e9-unknown_filename.9-dfbae2.png">
<meta property="article:published_time" content="2025-12-16T13:59:22.670Z">
<meta property="article:modified_time" content="2024-04-01T02:56:00.000Z">
<meta property="article:author" content="å…­æœˆçš„é›¨">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-d535d118941b2ce613d96a00372c86b5-unknown_filename.12-47e09f.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>å¤šè¿›ç¨‹Binder - å…­æœˆçš„é›¨çš„ç¬”è®°</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"peiniwan.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>å…­æœˆçš„é›¨çš„åšå®¢</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="å¤šè¿›ç¨‹Binder"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-12-16 21:59" pubdate>
          2025å¹´12æœˆ16æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          51 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">å¤šè¿›ç¨‹Binder</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="è¿›ç¨‹é—´é€šä¿¡-ipc"><a href="#è¿›ç¨‹é—´é€šä¿¡-ipc" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡(ipc)"></a>è¿›ç¨‹é—´é€šä¿¡(ipc)</h1><p>[[7-Webviewå¤šè¿›ç¨‹æ–¹æ¡ˆ]]</p>
<p>IPCçš„ä¸»è¦ç›®çš„æ˜¯<em>è°ƒç”¨å…¶ä»–è¿›ç¨‹çš„å‡½æ•°</em></p>
<ul>
<li>ä½¿ç”¨å¤šè¿›ç¨‹æ˜¾è€Œæ˜“è§çš„å¥½å¤„å°±æ˜¯åˆ†æ‹…ä¸»è¿›ç¨‹çš„å†…å­˜å‹åŠ›ã€‚æˆ‘ä»¬çš„åº”ç”¨è¶Šåšè¶Šå¤§ï¼Œå†…å­˜è¶Šæ¥è¶Šå¤šï¼Œå°†ä¸€äº›ç‹¬ç«‹çš„ç»„ä»¶æ”¾åˆ°ä¸åŒçš„è¿›ç¨‹ï¼Œå®ƒå°±ä¸å ç”¨ä¸»è¿›ç¨‹çš„å†…å­˜ç©ºé—´äº†ã€‚å½“ç„¶è¿˜æœ‰å…¶ä»–å¥½å¤„ï¼Œæœ‰äº›åº”ç”¨åå°æ˜¯æœ‰å¤šä¸ªè¿›ç¨‹çš„ï¼Œå¯åŠ¨ä¸€ä¸ªä¸å¯è§çš„è½»é‡çº§ç§æœ‰è¿›ç¨‹ï¼Œåœ¨åå°æ”¶å‘æ¶ˆæ¯ï¼Œæˆ–è€…åšä¸€äº›è€—æ—¶çš„äº‹æƒ…ï¼Œæˆ–è€…å¼€æœºå¯åŠ¨è¿™ä¸ªè¿›ç¨‹ï¼Œç„¶ååšç›‘å¬ç­‰ã€‚è¿˜æœ‰å°±æ˜¯é˜²æ­¢ä¸»è¿›ç¨‹è¢«æ€å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ˆæŠ¤è¿›ç¨‹å’Œä¸»è¿›ç¨‹ä¹‹é—´ç›¸äº’ç›‘è§†ï¼Œæœ‰ä¸€æ–¹è¢«æ€å°±é‡æ–°å¯åŠ¨å®ƒã€‚å› ä¸ºå®ƒä»¬è¦å¸¸é©»åå°ï¼Œç‰¹åˆ«æ˜¯å³æ—¶é€šè®¯æˆ–è€…ç¤¾äº¤åº”ç”¨</li>
<li>æ¨é€ã€èäº‘</li>
</ul>
<p><strong>ä»€ä¹ˆæ—¶å€™ç”¨æœåŠ¡</strong><br>ä¸éœ€è¦å’Œç”¨æˆ·äº¤äº’è€Œä¸”è¿˜è¦é•¿æœŸè¿è¡Œçš„ä»»åŠ¡ã€‚æœåŠ¡çš„è¿è¡Œä¸ä¾èµ–äºä»»ä½•ç”¨æˆ·ç•Œé¢ï¼Œå³ä½¿ç¨‹åºè¢«åˆ‡æ¢åˆ°åå°ï¼Œæˆ–è€…ç”¨æˆ·æ‰“å¼€äº†å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ŒæœåŠ¡ä»ç„¶èƒ½å¤Ÿä¿æŒç‹¬ç«‹è¿è¡Œã€‚éŸ³ä¹ã€æ’­æ”¾å™¨</p>
<p>å¦‚æœä¸€ä¸ª app ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶æ“ä½œ sharedpreferencesï¼Œå¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ã€‚ä¸èƒ½ï¼Œä½¿ç”¨ContentProviderã€mmkv </p>
<h2 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/freekiteyu/article/details/70082302">https://blog.csdn.net/freekiteyu/article/details/70082302</a></p>
<p><a target="_blank" rel="noopener" href="https://yuandaimaahao.github.io/AndroidFrameworkTutorialPages/003.%E5%AD%A6%E7%A9%BFBinder%E7%AF%87/006.Android%20Binder%20%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1%E5%88%86%E6%9E%90.html">Android Binder é©±åŠ¨æ¡†æ¶è®¾è®¡ä¸åˆ†æ</a></p>
<ul>
<li>Binder æ˜¯ Android ç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šè®¯ï¼ˆIPCï¼‰çš„ä¸€ç§æ–¹å¼ã€‚ä¸åŒè¿›ç¨‹ã€ä¸åŒ APP é—´å°±æ˜¯é€šè¿‡ binder é€šè®¯çš„ã€‚Binder é€šä¿¡é‡‡ç”¨ C&#x2F;S æ¶æ„ï¼Œä»ç»„ä»¶è§†è§’æ¥è¯´ï¼ŒåŒ…å« Clientã€ Serverã€ ServiceManager ä»¥åŠ Binder é©±åŠ¨ã€‚</li>
<li>æœåŠ¡ç«¯æä¾›æœåŠ¡ï¼Œå®¢æˆ·ç«¯è·å–æ•°æ®ã€‚<em>ServiceManager çš„ä½œç”¨æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡</em>ã€‚Binder é©±åŠ¨æ˜¯è¿è¡Œåœ¨å†…æ ¸ç©ºé—´ (liux)ï¼Œè¿›ç¨‹é—´é€šè®¯çš„æœ€åº•å±‚å°±æ˜¯ Binder é©±åŠ¨ã€‚å®ƒä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿä¸­ä¸€ç§å†…å­˜æ˜ å°„çš„æ–¹æ³•ã€‚</li>
<li>ServiceManager å°†ç”¨æˆ·ç©ºé—´çš„å‚æ•°ç­‰è¯·æ±‚æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œå¹¶å‘æœåŠ¡ç«¯æ’å…¥ä¸€æ¡æ‰§è¡Œæ–¹æ³•çš„äº‹åŠ¡ï¼ˆäº‹åŠ¡ï¼ˆTransactionï¼‰ï¼Œä¸€èˆ¬æ˜¯æŒ‡è¦åšçš„æˆ–æ‰€åšçš„äº‹æƒ…ï¼‰ã€‚äº‹åŠ¡æ‰§è¡Œå®Œé€šçŸ¥ ServiceManager å°†æ‰§è¡Œç»“æœä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ (binder_send_reply å‘é€ replyã€binder_write å®¢æˆ·ç«¯å†™)ï¼Œå“åº”ç»“æœï¼Œé€šè®¯å°±ç»“æŸäº†ã€‚</li>
<li>åœ¨ Android å¼€å‘ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ AIDLï¼Œå¹¶é€šè¿‡ç³»ç»Ÿç”Ÿæˆçš„ä»£ç æ¥å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡ã€‚AIDL å¯ä»¥å¤„ç†è·¨è¿›ç¨‹çš„æ–¹æ³•è°ƒç”¨ã€æ•°æ®ä¼ è¾“ã€å›è°ƒç­‰åŠŸèƒ½ï¼Œç®€åŒ–äº†å¼€å‘è€…åœ¨è¿›è¡Œè·¨è¿›ç¨‹é€šä¿¡æ—¶çš„ä»£ç ç¼–å†™å·¥ä½œã€‚</li>
</ul>
<p>Binder é©±åŠ¨ï¼šè¿è¡Œåœ¨<strong>å†…æ ¸ç©ºé—´ kernel</strong>ï¼Œè´Ÿè´£å„ä¸ªç”¨æˆ·è¿›ç¨‹é€šè¿‡ Binder å®ç°é€šä¿¡çš„å†…æ ¸æ¨¡å—ï¼ˆBinder Dirverï¼‰åº•å±‚å°±æ˜¯ Binder é©±åŠ¨</p>
<ul>
<li>å†…å­˜æ˜ å°„å°±æ˜¯<em>å°†ç”¨æˆ·ç©ºé—´çš„ä¸€å—å†…å­˜åŒºåŸŸæ˜ å°„åˆ°å†…æ ¸ç©ºé—´</em>ã€‚æ˜ å°„å…³ç³»å»ºç«‹åä¸åŒçš„è¿›ç¨‹çš„å†…æ ¸åœ°å€ç©ºé—´æ˜¯å…±äº«çš„ã€‚èƒ½å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå®ç°è¿›ç¨‹é—´é€šè®¯çš„é«˜æ•ˆäº’åŠ¨ã€‚</li>
<li><em>2æ¬¡æ‹·è´</em>ï¼Œå†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´å…±äº«å†…å­˜é€šè¿‡ copy_from_user (), copy_to_user () å†…æ ¸æ–¹æ³•æ¥å®Œæˆç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´å†…å­˜çš„æ•°æ®ä¼ è¾“ã€‚</li>
<li>ä¸åŒè¿›ç¨‹ä¹‹é—´çš„<strong>å†…æ ¸åœ°å€ç©ºé—´æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†åœ°å€</strong>ï¼Œå³ä¸åŒçš„è¿›ç¨‹çš„å†…æ ¸åœ°å€ç©ºé—´æ˜¯å…±äº«çš„ã€‚ä¸åŒè¿›ç¨‹ä¹‹é—´çš„ç”¨æˆ·åœ°å€ç©ºé—´æ˜ å°„åˆ°ä¸åŒçš„ç‰©ç†åœ°å€ï¼Œç›¸äº’ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œæ— æ³•è®¿é—®çš„ã€‚</li>
</ul>
<p>å†…å­˜æ˜ å°„èƒ½å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå®ç°ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„é«˜æ•ˆäº’åŠ¨ã€‚ä¸¤ä¸ªç©ºé—´å„è‡ªçš„ä¿®æ”¹èƒ½ç›´æ¥åæ˜ åœ¨æ˜ å°„çš„å†…å­˜åŒºåŸŸï¼Œä»è€Œè¢«å¯¹æ–¹ç©ºé—´åŠæ—¶æ„ŸçŸ¥ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œå†…å­˜æ˜ å°„èƒ½å¤Ÿæä¾›å¯¹è¿›ç¨‹é—´é€šä¿¡çš„æ”¯æŒã€‚<br><em>å®Œæˆæ˜ å°„åï¼Œè¿›ç¨‹åªéœ€è°ƒç”¨ä¸€æ¬¡Â <code>copy_from_user</code>ï¼ŒA è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´å°±å¯ä»¥è®¿é—®åˆ°Â <code>int a</code>ã€‚è¿™é‡Œä¼˜åŒ–åˆ°äº†ä¸€æ¬¡æ‹·è´</em></p>
<p><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-d535d118941b2ce613d96a00372c86b5-unknown_filename.12-47e09f.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.12|600"></p>
<p><em>æµç¨‹å›¾</em></p>
<p><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-21161fa4518997147db59bd538a79188-unknown_filename.3-11cf0f.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.3"></p>
<h3 id="MMAP"><a href="#MMAP" class="headerlink" title="MMAP"></a>MMAP</h3><p>Binder åªéœ€è¦ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œæ€§èƒ½æ›´å¥½<br>å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´å…±äº«å†…å­˜é€šè¿‡ copy_from_user (), copy_to_user () å†…æ ¸æ–¹æ³•æ¥å®Œæˆç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´å†…å­˜çš„æ•°æ®ä¼ è¾“</p>
<p>Binder IPC æœºåˆ¶ä¸­æ¶‰åŠåˆ°çš„å†…å­˜æ˜ å°„é€šè¿‡ mmap () æ¥å®ç°ï¼Œmmap () æ˜¯æ“ä½œç³»ç»Ÿä¸­ä¸€ç§å†…å­˜æ˜ å°„çš„æ–¹æ³•ã€‚å†…å­˜æ˜ å°„ç®€å•çš„è®²å°±æ˜¯å°†ç”¨æˆ·ç©ºé—´çš„ä¸€å—å†…å­˜åŒºåŸŸæ˜ å°„åˆ°å†…æ ¸ç©ºé—´ã€‚<em>æ˜ å°„å…³ç³»å»ºç«‹åï¼Œç”¨æˆ·å¯¹è¿™å—å†…å­˜åŒºåŸŸçš„ä¿®æ”¹å¯ä»¥ç›´æ¥ååº”åˆ°å†…æ ¸ç©ºé—´ï¼›åä¹‹å†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿèƒ½ç›´æ¥ååº”åˆ°ç”¨æˆ·ç©ºé—´ã€‚</em></p>
<p>å†…å­˜æ˜ å°„èƒ½å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå®ç°ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„é«˜æ•ˆäº’åŠ¨ã€‚ä¸¤ä¸ªç©ºé—´å„è‡ªçš„ä¿®æ”¹èƒ½ç›´æ¥åæ˜ åœ¨æ˜ å°„çš„å†…å­˜åŒºåŸŸï¼Œä»è€Œè¢«å¯¹æ–¹ç©ºé—´åŠæ—¶æ„ŸçŸ¥ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œå†…å­˜æ˜ å°„èƒ½å¤Ÿæä¾›å¯¹è¿›ç¨‹é—´é€šä¿¡çš„æ”¯æŒã€‚<br><em>å®Œæˆæ˜ å°„åï¼Œè¿›ç¨‹åªéœ€è°ƒç”¨ä¸€æ¬¡Â <code>copy_from_user</code>ï¼ŒA è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´å°±å¯ä»¥è®¿é—®åˆ°Â <code>int o</code>ã€‚è¿™é‡Œä¼˜åŒ–åˆ°äº†ä¸€æ¬¡æ‹·è´</em></p>
<p><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-d535d118941b2ce613d96a00372c86b5-unknown_filename.12-47e09f.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.12|600"><br><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-b0a684a7ade4b9dcbfe5d57315147ab6-unknown_filename-389477.png" srcset="/img/loading.gif" lazyload alt="unknown_filename|600"></p>
<h3 id="ServiceManager"><a href="#ServiceManager" class="headerlink" title="ServiceManager"></a>ServiceManager</h3><p>[[1-Androidçš„å¯åŠ¨æµç¨‹#ServiceManager]]</p>
<ul>
<li>ServiceManager åˆ†ä¸º framework å±‚å’Œ native å±‚ï¼Œframework å±‚åªæ˜¯å¯¹ native å±‚è¿›è¡Œäº†å°è£…æ–¹ä¾¿è°ƒç”¨ã€‚</li>
<li>ServiceManager çš„ä½œç”¨å¾ˆç®€å•å°±æ˜¯æä¾›äº†æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡çš„åŠŸèƒ½ã€‚</li>
<li>è´Ÿè´£ç®¡ç†ç³»ç»Ÿä¸­çš„ Service ç»„ä»¶ï¼Œå¹¶ä¸”å‘ Client ç»„ä»¶æä¾›è·å– Service ä»£ç†å¯¹è±¡çš„æœåŠ¡ã€‚</li>
</ul>
<p>ServiceManager è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼Œå› æ­¤ï¼ŒService ç»„ä»¶å’Œ Client ç»„ä»¶ä¹Ÿéœ€è¦é€šè¿‡è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶æ¥å’Œå®ƒäº¤äº’ï¼Œè€Œé‡‡ç”¨çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶æ­£å¥½ä¹Ÿæ˜¯ Binder è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚</p>
<p><em>ServiceManager æ˜¯ç”± init è¿›ç¨‹è´Ÿè´£å¯åŠ¨çš„</em>ï¼Œè€Œ init è¿›ç¨‹æ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨çš„ï¼Œå› æ­¤ï¼ŒServiceManager ä¹Ÿæ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ã€‚</p>
<p><strong>æœ€åå¼€å¯ loop ä¸æ–­çš„å¤„ç†å…±äº«å†…å­˜ä¸­çš„æ•°æ®</strong>ï¼Œæ— é™å¾ªç¯æ¥ç­‰å¾…å’Œå¤„ç† Service ç»„ä»¶å’Œ Client ç»„ä»¶çš„è¿›ç¨‹é—´é€šä¿¡è¯·æ±‚</p>
<h3 id="é©±åŠ¨"><a href="#é©±åŠ¨" class="headerlink" title="é©±åŠ¨"></a>é©±åŠ¨</h3><p>Binderæ˜¯ä¸€ç§è™šæ‹Ÿçš„ç‰©ç†è®¾å¤‡é©±åŠ¨</p>
<ul>
<li>è™šæ‹Ÿè®¾å¤‡é©±åŠ¨ç¨‹åºï¼šè™šæ‹Ÿè®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯æ¨¡æ‹Ÿç¡¬ä»¶è®¾å¤‡çš„é©±åŠ¨ç¨‹åºã€‚å®ƒæ¨¡æ‹Ÿäº†ä¸€å—ç¡¬ä»¶ï¼Œå› æ­¤è½¯ä»¶å¯èƒ½ä¼šæœ‰è®¿é—®çœŸå®ç¡¬ä»¶çš„é”™è§‰ã€‚ä¸€äº›è™šæ‹Ÿè®¾å¤‡é©±åŠ¨ç¨‹åºç¤ºä¾‹æ˜¯è™šæ‹Ÿç½‘ç»œé€‚é…å™¨ï¼Œè™šæ‹ŸDVD &#x2F; CDé©±åŠ¨å™¨ï¼Œè™šæ‹Ÿç£ç›˜ï¼ˆå†…å­˜ï¼‰ç­‰</li>
<li>é©±åŠ¨æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä»…ä»åŠŸèƒ½çš„è§’åº¦æ¥è¯´ï¼Œé©±åŠ¨ç¨‹åºä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®ç¡¬ä»¶ã€‚</li>
<li>é‚£åº”ç”¨æ˜¯å¦‚ä½•è®¿é—®ç¡¬ä»¶çš„ï¼Ÿ<em>linux ä¸­ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œè®¿é—®ç¡¬ä»¶å°±æ˜¯å¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œ</em>ã€‚æ¯”å¦‚ led ç¯å¯¹åº”çš„æ–‡ä»¶æ˜¯ &#x2F;dev&#x2F;led, è¯»å†™è¿™ä¸ªæ–‡ä»¶å°±èƒ½æ“ä½œ led ç¯ã€‚è€Œbinderé©±åŠ¨å°±æ˜¯è¯»å†™ç¡¬ä»¶å†…å­˜åŒºåŸŸ</li>
</ul>
<h3 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h3><p>åœ¨ Linux ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´ã€‚è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´åˆåˆ†ä¸ºäº†ç”¨æˆ·åœ°å€ç©ºé—´å’Œå†…æ ¸åœ°å€ç©ºé—´ã€‚</p>
<p>è™šæ‹Ÿå†…å­˜ é€šè¿‡åˆ›å»ºè™šæ‹Ÿåœ°å€ç©ºé—´æ¥éš”ç¦»ä¸åŒè¿›ç¨‹çš„å†…å­˜è®¿é—®ï¼Œè§£å†³äº†å¤šè¿›ç¨‹è¿è¡Œæ—¶çš„å†…å­˜å†²çªé—®é¢˜ã€‚<em>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¹¶é€šè¿‡ MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰ å°†è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†å†…å­˜åœ°å€ä¸Š</em>ï¼Œä»è€Œå®ç°å¯¹ç‰©ç†å†…å­˜çš„è®¿é—®å’Œç®¡ç†ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://yuandaimaahao.github.io/AndroidFrameworkTutorialPages/003.%E5%AD%A6%E7%A9%BFBinder%E7%AF%87/002.Binder%20%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86.html">Binder åŸºæœ¬åŸç† | Android Framework</a></p>
<p><strong>å®¢æˆ·ç«¯æ€ä¹ˆæ‰§è¡ŒæœåŠ¡ç«¯çš„æ–¹æ³•</strong></p>
<ul>
<li>æˆ‘ä»¬ä»¬åœ¨ä½¿ç”¨ Binder æ—¶åŸºæœ¬éƒ½æ˜¯è°ƒç”¨ framework å±‚å°è£…å¥½çš„æ–¹æ³•ï¼ŒAIDL å°±æ˜¯ framework å±‚æä¾›çš„å‚»ç“œå¼æ˜¯ä½¿ç”¨æ–¹å¼ã€‚å‡è®¾æœåŠ¡å·²ç»æ³¨å†Œå®Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®¢æˆ·ç«¯æ€ä¹ˆæ‰§è¡ŒæœåŠ¡ç«¯çš„æ–¹æ³•ã€‚</li>
<li>é¦–å…ˆæˆ‘ä»¬é€šè¿‡ ServiceManager è·å–åˆ°æœåŠ¡ç«¯çš„ BinderProxy ä»£ç†å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨ BinderProxy å°†å‚æ•°ï¼Œæ–¹æ³•æ ‡è¯†ï¼ˆä¾‹å¦‚ï¼šTRANSACTION_testï¼ŒAIDLä¸­è‡ªåŠ¨ç”Ÿæˆï¼‰ä¼ ç»™ ServiceManagerï¼ŒåŒæ—¶å®¢æˆ·ç«¯çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</li>
<li>ServiceManager å°†ç”¨æˆ·ç©ºé—´çš„å‚æ•°ç­‰è¯·æ±‚æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œå¹¶å‘æœåŠ¡ç«¯æ’å…¥ä¸€æ¡æ‰§è¡Œæ‰§è¡Œæ–¹æ³•çš„äº‹åŠ¡ã€‚äº‹åŠ¡æ‰§è¡Œå®Œé€šçŸ¥ ServiceManager å°†æ‰§è¡Œç»“æœä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œå“åº”ç»“æœï¼Œé€šè®¯ç»“æŸã€‚</li>
</ul>
<p><strong>Binder é€šä¿¡ä¸­çš„ä»£ç†æ¨¡å¼</strong></p>
<ul>
<li>æˆ‘ä»¬å·²ç»è§£é‡Šæ¸…æ¥š Clientã€Server å€ŸåŠ© Binder é©±åŠ¨å®Œæˆè·¨è¿›ç¨‹é€šä¿¡çš„å®ç°æœºåˆ¶äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜ä¼šè®©æˆ‘ä»¬å›°æƒ‘ã€‚A è¿›ç¨‹æƒ³è¦ B è¿›ç¨‹ä¸­æŸä¸ªå¯¹è±¡ï¼ˆobjectï¼‰æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæ¯•ç«Ÿå®ƒä»¬åˆ†å±ä¸åŒçš„è¿›ç¨‹ï¼ŒA è¿›ç¨‹ æ²¡æ³•ç›´æ¥ä½¿ç”¨ B è¿›ç¨‹ä¸­çš„ objectã€‚</li>
<li>åœ¨æ•°æ®æµç» Binder é©±åŠ¨çš„æ—¶å€™é©±åŠ¨ä¼šå¯¹æ•°æ®åšä¸€å±‚è½¬æ¢ã€‚å½“ A è¿›ç¨‹æƒ³è¦è·å– B è¿›ç¨‹ä¸­çš„ object æ—¶ï¼Œé©±åŠ¨å¹¶ä¸ä¼šçœŸçš„æŠŠ object è¿”å›ç»™ Aï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ªè·Ÿ object çœ‹èµ·æ¥ä¸€æ¨¡ä¸€æ ·çš„ä»£ç†å¯¹è±¡ ProxyObjectï¼Œè¿™ä¸ª ProxyObject å…·æœ‰å’Œ object ä¸€æ‘¸ä¸€æ ·çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•å¹¶æ²¡æœ‰ B è¿›ç¨‹ä¸­ object å¯¹è±¡é‚£äº›æ–¹æ³•çš„èƒ½åŠ›ï¼Œè¿™äº›æ–¹æ³•åªéœ€è¦æŠŠæŠŠè¯·æ±‚å‚æ•°äº¤ç»™é©±åŠ¨å³å¯ã€‚å¯¹äº A è¿›ç¨‹æ¥è¯´å’Œç›´æ¥è°ƒç”¨ object ä¸­çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>å½“ Binder é©±åŠ¨æ¥æ”¶åˆ° A è¿›ç¨‹çš„æ¶ˆæ¯åï¼Œå‘ç°è¿™æ˜¯ä¸ª objectProxy å°±å»æŸ¥è¯¢è‡ªå·±ç»´æŠ¤çš„è¡¨å•ï¼Œä¸€æŸ¥å‘ç°è¿™æ˜¯ B è¿›ç¨‹ object çš„ä»£ç†å¯¹è±¡ã€‚äºæ˜¯å°±ä¼šå»é€šçŸ¥ B è¿›ç¨‹è°ƒç”¨ object çš„æ–¹æ³•ï¼Œå¹¶è¦æ±‚ B è¿›ç¨‹æŠŠè¿”å›ç»“æœå‘ç»™è‡ªå·±ã€‚å½“é©±åŠ¨æ‹¿åˆ° B è¿›ç¨‹çš„è¿”å›ç»“æœåå°±ä¼šè½¬å‘ç»™ A è¿›ç¨‹ï¼Œä¸€æ¬¡é€šä¿¡å°±å®Œæˆäº†</li>
</ul>
<p><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-7a752757f78b00d53af8a44434318362-unknown_filename.1-cad1b1.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.1|600"></p>
<h2 id="å¸¸è§„é€šè®¯"><a href="#å¸¸è§„é€šè®¯" class="headerlink" title="å¸¸è§„é€šè®¯"></a>å¸¸è§„é€šè®¯</h2><p>è¿›ç¨‹é—´é€šä¿¡å°±æ˜¯ä¸ºäº†å®ç°æ•°æ®å…±äº«ã€‚ä¸€ä¸ªç¨‹åºä¸åŒç»„ä»¶åœ¨ä¸åŒè¿›ç¨‹ä¹Ÿå«å¤šè¿›ç¨‹ï¼Œå’Œä¿©ä¸ªåº”ç”¨æ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚ä½¿ç”¨ process å±æ€§å¯ä»¥å®ç°å¤šè¿›ç¨‹ï¼Œä½†æ˜¯ä¼šå¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼Œä¸»è¦åŸå› æ˜¯å…±äº«æ•°æ®ä¼šå¤±è´¥ï¼Œå¼Šç«¯æœ‰: <em>é™æ€å’Œå•åˆ©å¤±æ•ˆï¼ŒåŒæ­¥å¤±æ•ˆï¼Œsharedprefer ä¹Ÿå˜çš„ä¸å¯é ç­‰é—®é¢˜</em>ã€‚</p>
<p>åªæœ‰å…è®¸ä¸åŒåº”ç”¨çš„å®¢æˆ·ç«¯ç”¨ IPC æ–¹å¼è®¿é—®æœåŠ¡ï¼Œå¹¶ä¸”æƒ³è¦åœ¨æœåŠ¡ä¸­å¤„ç†å¤šçº¿ç¨‹ï¼ˆå¤šä»»åŠ¡ï¼‰æ—¶ï¼Œæ‰æœ‰å¿…è¦ä½¿ç”¨ AIDLã€‚ å¦‚æœæ‚¨ä¸éœ€è¦æ‰§è¡Œè·¨è¶Šä¸åŒåº”ç”¨çš„å¹¶å‘ IPCï¼Œå°±åº”è¯¥é€šè¿‡å®ç°ä¸€ä¸ª BinderÂ åˆ›å»ºæ¥å£ï¼›æˆ–è€…ï¼Œå¦‚æœæ‚¨æƒ³æ‰§è¡Œ IPCï¼Œä½†æ ¹æœ¬ä¸éœ€è¦å¤„ç†å¤šçº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨ Messenger ç±»æ¥å®ç°æ¥å£ã€‚æ— è®ºå¦‚ä½•ï¼Œåœ¨å®ç° AIDL ä¹‹å‰ï¼Œè¯·æ‚¨åŠ¡å¿…ç†è§£ç»‘å®šæœåŠ¡ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/aidl?hl=zh-cn">aidlæ–‡æ¡£</a></p>
<h3 id="AIDL"><a href="#AIDL" class="headerlink" title="AIDL"></a>AIDL</h3><p>AndroidÂ interfaceÂ definitionÂ languageÂ (androidæ¥å£å®šä¹‰è¯­è¨€)Â ,Â ç”¨æ¥è·¨è¿›ç¨‹çš„è®¿é—®æ–¹æ³•ã€‚</p>
<p><strong>AIDL æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆå®ç°çš„ï¼Œä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸ªæ–‡ä»¶ aidl</strong><br>1ï¼‰ã€å®šä¹‰AIDLæ–‡ä»¶ï¼›â€”â€”ç±»ä¼¼äºåå°ç»™äº†ä¸€ä¸ªæ¥å£æ–‡æ¡£ï¼Œé‡Œé¢æè¿°äº†å„ç§å„æ ·çš„æ¥å£ï¼Œè€Œåœ¨AIDLæ–‡ä»¶ä¸­æè¿°çš„æ˜¯ç±»ä¼¼äºJAVAæ¥å£çš„æ–¹æ³•å®šä¹‰<br>2ï¼‰ã€å®ç°AIDLæ–‡ä»¶é‡Œé¢å®šä¹‰çš„æ¥å£ï¼›â€”â€”ç±»ä¼¼äºåå°å®ç°æ¥å£æ–‡æ¡£çš„æ¥å£æ§åˆ¶å™¨ï¼Œé‡Œé¢å®šä¹‰äº†æ¥å£çš„å…·ä½“å®ç°<br>3ï¼‰ã€æš´éœ²æ¥å£ï¼›â€”â€”è¿™ä¸ªå°±åƒåå°å¼€å‘äººå‘˜æŠŠæ¥å£æ–‡æ¡£ç»™Appå¼€å‘äººå‘˜ï¼Œç„¶åAppå¼€å‘äººå‘˜å°±çŸ¥é“æœ‰å“ªäº›æ¥å£å¯ä»¥è°ƒç”¨æ¥å®ç°ä¸šåŠ¡äº†<br>4ï¼‰ã€è°ƒç”¨ï¼›â€”â€”è¿™ä¸ªå°±æ˜¯Appå¼€å‘äººå‘˜è°ƒç”¨åå°çš„æ¥å£æ¥è·å–è¿‡ç¨‹æ•°æ®äº†ã€‚<br>ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªAIDLå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªC&#x2F;Sæ¨¡å‹ï¼Œä¸€è¾¹æ˜¯å®¢æˆ·ç«¯ï¼Œä¸€è¾¹æ˜¯æœåŠ¡å™¨ã€‚</p>
<h4 id="aidl-æ“ä½œæ­¥éª¤"><a href="#aidl-æ“ä½œæ­¥éª¤" class="headerlink" title="aidl æ“ä½œæ­¥éª¤"></a>aidl æ“ä½œæ­¥éª¤</h4><ol>
<li>åœ¨ä¸¤ä¸ªé¡¹ç›®ä¸­æ–°å»ºaidlæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸­è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„åŒ…åè¦ä¿æŒä¸€è‡´ï¼Œå†…å®¹ä¹Ÿè¦ä¸€æ ·ï¼Œåœ¨æ¥å£æ–‡ä»¶AIDLFunctions.aidlä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–¹æ³• show</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">interface</span> <span class="hljs-title">AidlFunctions</span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show</span>()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>ç¼–è¯‘ä¹‹åï¼Œ ä¼šåœ¨buildç›®å½•ä¸‹ï¼Œè‡ªåŠ¨äº§ç”ŸåŒåçš„ï¼Œåç¼€ä¸º java çš„æ–‡ä»¶ã€‚é‡Œé¢æœ‰æˆ‘ä»¬è¦ç”¨åˆ°çš„ Stubå†…éƒ¨ç±»ã€‚ com.example.aidl.AidlFunctionsæ˜¯åˆšå®šä¹‰ã€‚<br> é‡Œé¢çš„ä¸œè¥¿</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">public static <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Stub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">android</span>.<span class="hljs-title">os</span>.<span class="hljs-title">Binder</span> <span class="hljs-title">implements</span>  <span class="hljs-title">com</span>.<span class="hljs-title">example</span>.<span class="hljs-title">aidl</span>.<span class="hljs-title">AidlFunctions</span></span><br></code></pre></td></tr></table></figure>

<p><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-42c476195f8b467a65124b26e57e4978-unknown_filename.2-5f90d1.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.2"></p>
<ol start="3">
<li>AIDLçš„ä½¿ç”¨ï¼Œéœ€è¦ä¸€ä¸ªServiceé…åˆï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æœåŠ¡ç«¯è¿˜è¦å£°æ˜ä¸€ä¸ªServiceï¼Œæ¥æ¥æ”¶æ¶ˆæ¯</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIDLService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Service</span> &#123;<br><span class="hljs-comment">//stubå°±æ˜¯ç³»ç»Ÿè‡ªåŠ¨äº§ç”Ÿçš„</span><br>    AidlFunctions.Stub binder;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-built_in">super</span>.onCreate();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IBinder <span class="hljs-title function_">onBind</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        binder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AidlFunctions</span>.Stub() &#123;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-comment">//è¿™é‡Œæ˜¯æˆ‘ä»¬åœ¨æ¥å£ä¸­å£°æ˜çš„æ–¹æ³•çš„å®ç°</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>                System.out.println(<span class="hljs-string">&quot;--------------------æ”¶åˆ°----------------------&quot;</span>);<br>            &#125;<br>        &#125;;<br>        <span class="hljs-keyword">return</span> binder;<br>    &#125;   <br>&#125;<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/29999c1a93cd">https://www.jianshu.com/p/29999c1a93cd</a><br>éœ€è¦æŠŠæœåŠ¡ç«¯çš„AIDLæ–‡ä»¶ä»¥åŠBookç±»å¤åˆ¶è¿‡æ¥ï¼Œå°† aidl æ–‡ä»¶å¤¹æ•´ä¸ªå¤åˆ¶åˆ°å’ŒJavaæ–‡ä»¶å¤¹åŒä¸ªå±‚çº§ä¸‹ï¼Œä¸éœ€è¦æ”¹åŠ¨ä»»ä½•ä»£ç </p>
<p><em>è¿œç«¯æœåŠ¡é€šè¿‡actionç»‘å®š</em><br><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-d772d3e8ddede1b16cb9d97bc67c5849-unknown_filename.8-d4944c.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.8"></p>
<ol start="4">
<li>å®¢æˆ·ç«¯ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç»‘å®šæœåŠ¡ï¼Œè¦ç”¨åˆ°ServiceConnection </span><br><span class="hljs-keyword">private</span> ServiceConnection serviceConnection;<br><span class="hljs-comment">//è‡ªå®šä¹‰çš„æ¥å£ï¼Œå’ŒæœåŠ¡ç«¯ä¸€æ ·</span><br><span class="hljs-keyword">private</span> AidlFunctions aidlFunctions;<br><br>serviceConnection = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceConnection</span>() &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;--------------------ServiceDisconnected----------------------&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;--------------------ServiceConnected----------------------&quot;</span>);<br>        aidlFunctions = AidlFunctions.Stub.asInterface(service);<br>    &#125;<br>&#125;;<br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-string">&quot;com.example.androidaidl.AIDLService&quot;</span>);<br>bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE);<br><span class="hljs-comment">//è°ƒç”¨showæ–¹æ³•</span><br><span class="hljs-keyword">try</span> &#123;<br>    aidlFunctions.show();<br>&#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>    <span class="hljs-comment">// TODO Auto-generated catch block</span><br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="AIDL-ç”Ÿæˆçš„æ–‡ä»¶"><a href="#AIDL-ç”Ÿæˆçš„æ–‡ä»¶" class="headerlink" title="AIDL ç”Ÿæˆçš„æ–‡ä»¶"></a>AIDL ç”Ÿæˆçš„æ–‡ä»¶</h4><p><strong>stub å…·ä½“å®ç°ç±»ã€proxy ä»£ç†ç±»</strong></p>
<p><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/09/15/2024-02-27-17-32-0b27ffc6ca61560ee597113bd4cf43ca-18-50-43-0b27ffc6ca61560ee597113bd4cf43ca-unknown_filename.7-0448c0-598490.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.7"></p>
<ol>
<li>åŸºæœ¬è§’è‰²</li>
</ol>
<ul>
<li><p><strong>Client ç«¯ï¼ˆå·¦è¾¹ Activity éƒ¨åˆ†ï¼‰</strong></p>
<ul>
<li>è°ƒç”¨ <code>bindService()</code> ç»‘å®šæœåŠ¡ã€‚</li>
<li>ç»‘å®šæˆåŠŸåï¼Œç³»ç»Ÿå›è°ƒ <code>onServiceConnected()</code>ï¼Œå¾—åˆ°ä¸€ä¸ª <code>IBinder</code> å¯¹è±¡ï¼ˆ<code>mRemoteService</code>ï¼‰ã€‚</li>
<li>é€šè¿‡ <code>Stub.asInterface()</code> å°† <code>IBinder</code> è½¬æ¢ä¸º <code>Ixxx</code> æ¥å£å¯¹è±¡ï¼ˆå…¶å®æ˜¯ <code>Stub.Proxy</code>ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>Service ç«¯ï¼ˆå³è¾¹ RemoteService éƒ¨åˆ†ï¼‰</strong></p>
<ul>
<li>åœ¨ <code>onBind()</code> æ–¹æ³•é‡Œè¿”å›ä¸€ä¸ª <code>Binder</code> å¯¹è±¡ï¼ˆ<code>mRemoteBinder</code>ï¼‰ã€‚</li>
<li>è¿™ä¸ª Binder å®é™…ä¸Šæ˜¯ <code>Ixxx.Stub</code> çš„å®ä¾‹ã€‚</li>
</ul>
</li>
<li><p><strong>Binder é©±åŠ¨å±‚ï¼ˆä¸­é—´çš„ AMS &#x2F; Binder Driverï¼‰</strong></p>
<ul>
<li>å±äº <strong>å†…æ ¸ç©ºé—´</strong>ï¼Œè´Ÿè´£è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æ•°æ®ä¼ è¾“ã€‚</li>
<li>Client å’Œ Service ä¸ç›´æ¥é€šä¿¡ï¼Œè€Œæ˜¯é€šè¿‡ Binder é©±åŠ¨ã€‚</li>
</ul>
</li>
</ul>
<ol start="2">
<li>AIDL å·¥å…·ç”Ÿæˆçš„ä»£ç </li>
</ol>
<ul>
<li><p>**<code>Ixxx.aidl</code>**ï¼šå®šä¹‰æ¥å£æ–¹æ³•ï¼ˆå¦‚ <code>doXXX()</code>ï¼‰ã€‚</p>
</li>
<li><p><strong><code>Ixxx.java</code>ï¼ˆAIDL å·¥å…·è‡ªåŠ¨ç”Ÿæˆï¼‰</strong></p>
<ul>
<li><p>**<code>Ixxx.Stub</code>**ï¼ˆæŠ½è±¡ç±»ï¼Œç»§æ‰¿è‡ª Binderï¼‰</p>
<ul>
<li>åœ¨ Service ç«¯ä½¿ç”¨ï¼Œè´Ÿè´£æ¥æ”¶è°ƒç”¨å¹¶åˆ†å‘åˆ°å…·ä½“å®ç°ã€‚</li>
<li>æ ¸å¿ƒæ–¹æ³•ï¼š<ul>
<li><code>onTransact()</code>ï¼šæ¥æ”¶æ¥è‡ª Client çš„è¯·æ±‚ï¼ˆIPCï¼‰ã€‚</li>
<li><code>doXXX()</code>ï¼šå®é™…é€»è¾‘å®ç°ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p>**<code>Ixxx.Stub.Proxy</code>**ï¼ˆå†…éƒ¨ç±»ï¼‰</p>
<ul>
<li>åœ¨ Client ç«¯ä½¿ç”¨ï¼Œä»£è¡¨ Service çš„ä»£ç†å¯¹è±¡ã€‚</li>
<li>è°ƒç”¨ <code>doXXX()</code> æ—¶ï¼Œæœ€ç»ˆé€šè¿‡ Binder é©±åŠ¨å‘åˆ°è¿œç¨‹ Serviceã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li><p>é€šä¿¡æµç¨‹ï¼ˆæŒ‰å›¾èµ°ä¸€éï¼‰</p>
</li>
<li><p><strong>å®¢æˆ·ç«¯å‘èµ·ç»‘å®š</strong></p>
<ul>
<li><code>Activity.bindService()</code> â†’ AMS â†’ è¿œç¨‹ <code>Service.onBind()</code>ã€‚</li>
<li>Service è¿”å› <code>Ixxx.Stub</code> çš„å®ä¾‹ï¼ˆ<code>mRemoteBinder</code>ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>å®¢æˆ·ç«¯è·å¾—æ¥å£å¯¹è±¡</strong></p>
<ul>
<li>ç³»ç»Ÿå›è°ƒ <code>onServiceConnected()</code>ã€‚</li>
<li>å¾—åˆ° <code>IBinder</code> å¯¹è±¡ â†’ <code>Stub.asInterface(mRemoteBinder)</code> â†’ ç”Ÿæˆ <code>Ixxx.Stub.Proxy</code>ã€‚</li>
</ul>
</li>
<li><p><strong>è°ƒç”¨è¿œç¨‹æ–¹æ³•</strong></p>
<ul>
<li>å®¢æˆ·ç«¯è°ƒç”¨ <code>mRemoteService.doXXX()</code>ã€‚</li>
<li>å®é™…ä¸Šæ˜¯è°ƒç”¨ <code>Proxy.doXXX()</code>ï¼Œæ•°æ®é€šè¿‡ Binder é©±åŠ¨å‘åˆ° Service è¿›ç¨‹ã€‚</li>
</ul>
</li>
<li><p><strong>æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚</strong></p>
<ul>
<li><code>Stub.onTransact()</code> è¢«è§¦å‘ã€‚</li>
<li>æ ¹æ®äº‹åŠ¡ code æ‰¾åˆ°å¯¹åº”æ–¹æ³• â†’ è°ƒç”¨çœŸæ­£çš„å®ç° <code>doXXX()</code>ã€‚</li>
</ul>
</li>
<li><p><strong>ç»“æœè¿”å›</strong></p>
<ul>
<li>æ‰§è¡Œç»“æœé€šè¿‡ Binder é©±åŠ¨å›ä¼ ç»™å®¢æˆ·ç«¯ã€‚</li>
<li><code>Proxy</code> æ¥æ”¶ç»“æœå¹¶è¿”å›ç»™è°ƒç”¨çš„ Activityã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li><strong>Proxy</strong>ï¼šå®¢æˆ·ç«¯çš„è¿œç¨‹ä»£ç†ï¼Œå‡è£…è‡ªå·±å°±æ˜¯æœåŠ¡ã€‚</li>
<li><strong>Stub</strong>ï¼šæœåŠ¡ç«¯çš„ Binderï¼Œè´Ÿè´£æ¥æ”¶å¹¶è½¬å‘è°ƒç”¨ã€‚</li>
<li><strong>Binder Driver</strong>ï¼šç³»ç»Ÿå†…æ ¸ï¼Œè´Ÿè´£ IPCã€‚</li>
<li><strong>AIDL å·¥å…·</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆ <code>Stub</code> å’Œ <code>Proxy</code>ï¼Œå¼€å‘è€…åªéœ€è¦å®ç°æ¥å£ã€‚</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“ï¼š<br>ğŸ‘‰ <strong>Activity è°ƒç”¨ Proxy â†’ Binder é©±åŠ¨è½¬å‘ â†’ Service çš„ Stub æ¥æ”¶å¹¶æ‰§è¡Œ â†’ è¿”å›ç»“æœã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IMyAidlInterface</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">sendData</span><span class="hljs-params">(String data)</span>;<br>    String <span class="hljs-title function_">getData</span><span class="hljs-params">()</span>;<br>&#125;<br><br><br><span class="hljs-comment">//ç”Ÿæˆ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IMyAidlInterface</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">android</span>.os.IInterface &#123;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Stub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">android</span>.os.Binder <span class="hljs-keyword">implements</span> <span class="hljs-title class_">com</span>.zero.aidleservicedemo.IMyAidlInterface &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">DESCRIPTOR</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.zero.aidleservicedemo.IMyAidlInterface&quot;</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Stub</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-built_in">this</span>.attachInterface(<span class="hljs-built_in">this</span>, DESCRIPTOR);<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * Cast an IBinder object into an com.zero.aidleservicedemo.IMyAidlInterface interface,</span><br><span class="hljs-comment">         * generating a proxy if needed.   ç”Ÿæˆä»£ç†éœ€è¦</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> com.zero.aidleservicedemo.IMyAidlInterface <span class="hljs-title function_">asInterface</span><span class="hljs-params">(android.os.IBinder obj)</span> &#123;<br>            <span class="hljs-keyword">if</span> ((obj == <span class="hljs-literal">null</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            android.os.<span class="hljs-type">IInterface</span> <span class="hljs-variable">iin</span> <span class="hljs-operator">=</span> obj.queryLocalInterface(DESCRIPTOR);<br>            <span class="hljs-keyword">if</span> (((iin != <span class="hljs-literal">null</span>) &amp;&amp; (iin <span class="hljs-keyword">instanceof</span> com.zero.aidleservicedemo.IMyAidlInterface))) &#123;<br>                <span class="hljs-keyword">return</span> ((com.zero.aidleservicedemo.IMyAidlInterface) iin);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">com</span>.zero.aidleservicedemo.IMyAidlInterface.Stub.Proxy(obj);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> android.os.IBinder <span class="hljs-title function_">asBinder</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTransact</span><span class="hljs-params">(<span class="hljs-type">int</span> code, android.os.Parcel data, android.os.Parcel reply, <span class="hljs-type">int</span> flags)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;<br>            java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">descriptor</span> <span class="hljs-operator">=</span> DESCRIPTOR;<br>            <span class="hljs-keyword">switch</span> (code) &#123;<br>               <span class="hljs-comment">//è‡ªå·±çš„æ–¹æ³•</span><br>                <span class="hljs-keyword">case</span> TRANSACTION_sendData: &#123;<br>           <br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>                <span class="hljs-keyword">case</span> TRANSACTION_getData: &#123;<br>                    data.enforceInterface(descriptor);<br>                    java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">_result</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getData();<br>                    reply.writeNoException();<br>                    reply.writeString(_result);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>                <span class="hljs-keyword">default</span>: &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onTransact(code, data, reply, flags);<br>                &#125;<br>            &#125;<br>        &#125;<br><br>       <span class="hljs-comment">//ä»£ç†ç±»</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">com</span>.zero.aidleservicedemo.IMyAidlInterface &#123;<br>            <span class="hljs-keyword">private</span> android.os.IBinder mRemote;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> android.os.IBinder <span class="hljs-title function_">asBinder</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> mRemote;<br>            &#125;<br><br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sendData</span><span class="hljs-params">(java.lang.String data)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;<br>                <span class="hljs-keyword">return</span> _result;<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> java.lang.String <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_data</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_reply</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                java.lang.String _result;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    _data.writeInterfaceToken(DESCRIPTOR);<br>                    mRemote.transact(Stub.TRANSACTION_getData, _data, _reply, <span class="hljs-number">0</span>);<br>                    _reply.readException();<br>                    _result = _reply.readString();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    _reply.recycle();<br>                    _data.recycle();<br>                &#125;<br>                <span class="hljs-keyword">return</span> _result;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sendData</span><span class="hljs-params">(java.lang.String data)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException;<br><br>    <span class="hljs-keyword">public</span> java.lang.String <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> android.os.RemoteException;<br>&#125;<br><br></code></pre></td></tr></table></figure>


<p><strong>onTransact</strong>, å…¸å‹çš„ä»£ç†æ¨¡å¼</p>
<ul>
<li>Server åˆ™æ˜¯é€šè¿‡ onTransact æ–¹æ³•æ¥æ”¶ Client è¿›ç¨‹ä¼ è¿‡æ¥çš„æ•°æ®ï¼ŒåŒ…æ‹¬å‡½æ•°åç§°ã€å‡½æ•°å‚æ•°ï¼Œæ‰¾åˆ°å¯¹åº”çš„å‡½æ•°ï¼ˆè¿™é‡Œæ˜¯ sum ï¼‰ï¼ŒæŠŠå‚æ•°å–‚è¿›å»ï¼Œå¾—åˆ°ç»“æœï¼Œè¿”å›ã€‚</li>
<li>æ‰€ä»¥ onTransact å‡½æ•°ç»å†äº†è¯»æ•°æ®â†’æ‰§è¡Œè¦è°ƒç”¨çš„å‡½æ•°â†’æŠŠæ‰§è¡Œç»“æœå†å†™æ•°æ®çš„è¿‡ç¨‹</li>
<li>æ³¨æ„ï¼Œåœ¨ AIDL çš„å¦ä¸€ç«¯ï¼Œæ˜¯é€šè¿‡ Stub ç±»çš„ onTransact æŠŠå€¼ä» data ä¸­å–å‡ºæ¥ï¼Œè®¡ç®—å®Œå¾—åˆ°ç»“æœï¼Œå†æŠŠç»“æœé€šè¿‡ reply è¿”å›ã€‚<br><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/09/15/2024-02-27-17-31-059823902e225e7587438407a9672fe5-18-50-43-059823902e225e7587438407a9672fe5-unknown_filename.4-d31a09-940e82.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.4|700|600"></li>
</ul>
<h3 id="å…¶ä»–é€šè®¯æ–¹æ³•"><a href="#å…¶ä»–é€šè®¯æ–¹æ³•" class="headerlink" title="å…¶ä»–é€šè®¯æ–¹æ³•"></a>å…¶ä»–é€šè®¯æ–¹æ³•</h3><p>socketã€binderã€ä¿¡å·é“¾ã€å…±äº«å†…å­˜<br>Intentã€Â Messengerã€AIDLï¼Œsharedpreã€å¹¿æ’­ã€scheme</p>
<ol>
<li>ä½¿ç”¨intentçš„é™„åŠ ä¿¡æ¯extrasæ¥ä¼ é€’ï¼Œé€šè¿‡bundleï¼Œä¼ é€’çš„æ˜¯bundleæ”¯æŒçš„ç±»å‹ï¼Œæ¯”å¦‚åŸºæœ¬æ•°æ®ç±»å‹ã€å®ç°pracellableæˆ–serializeableçš„å¯¹è±¡</li>
</ol>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">/**æŒ‡å®šåŒ…åå’Œå¸¦åŒ…åçš„Activityçš„åå­—*/</span><br>ComponentName componentName = <span class="hljs-keyword">new</span> <span class="hljs-type">ComponentName</span>(<span class="hljs-string">&quot;com.example.androidaidl&quot;</span>, <span class="hljs-string">&quot;com.example.androidaidl.MainActivity&quot;</span>);<br>Intent intent = <span class="hljs-keyword">new</span> <span class="hljs-type">Intent</span>();<br>intent.putExtra(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-number">1001</span>);<br>intent.setComponent(componentName);<br>startActivity(intent);      <br><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>ä½¿ç”¨æ–‡ä»¶å…±äº«ï¼Œåºåˆ—åŒ–æˆ–æ˜¯sharedpreï¼Œä¸è¿‡ä¸é€‚ç”¨äºè¯»å†™å¹¶å‘çš„æ“ä½œ</li>
<li>å¹¿æ’­ï¼šAndroidçš„å¹¿æ’­æ˜¯ç³»ç»Ÿçº§çš„ï¼Œåªè¦ä¼ é€’çš„Actionä¸€æ ·ï¼Œå°±å¯ä»¥æ¥æ”¶åˆ°å…¶ä»–è¿›ç¨‹å¹¿æ’­çš„æ¶ˆæ¯ï¼Œå¹¿æ’­ä¸­å¯ä»¥é€šè¿‡Intentä¼ é€’æ•°æ®ã€‚</li>
<li>schemeåè®®æ˜¯androidä¸­çš„ä¸€ç§é¡µé¢å†…è·³è½¬åè®®ï¼Œé€šè¿‡å®šä¹‰è‡ªå·±çš„schemeåè®®ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿è·³è½¬appä¸­çš„å„ä¸ªé¡µé¢ï¼Œå¹¶ä¸”ä¼ é€’æ•°æ®ï¼Œè¿˜æ˜¯å¯ä»¥é€šè¿‡H5é¡µé¢è·³è½¬æŒ‡å®šé¡µé¢ç­‰ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ganchuanpu/p/9288014.html">soket</a>,é•¿é“¾æ¥è¯»ç½‘ç»œæ•°æ®</li>
</ol>
<h3 id="ElegantBus"><a href="#ElegantBus" class="headerlink" title="ElegantBus"></a>ElegantBus</h3><blockquote>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>åŸºäº Binder çš„å¤šè¿›ç¨‹äº‹ä»¶æ€»çº¿æ–¹æ¡ˆ</strong>ã€‚<br>æ ¸å¿ƒæ€è·¯æ˜¯å¼•å…¥ä¸€ä¸ª<strong>ä¸­é—´ Service ä½œä¸ºé€šä¿¡æ¢çº½</strong>ï¼Œæ‰€æœ‰ä¸šåŠ¡è¿›ç¨‹é€šè¿‡ <code>bindService</code> è¿æ¥åˆ°å®ƒã€‚</p>
</blockquote>
<blockquote>
<p>å„è¿›ç¨‹åœ¨ Service ä¸­é€šè¿‡ <strong>AIDL Callback æ³¨å†Œè‡ªå·±</strong>ï¼ŒService ä½¿ç”¨ <code>RemoteCallbackList</code> ç»Ÿä¸€ç®¡ç†è¿™äº›è·¨è¿›ç¨‹å›è°ƒï¼Œè‡ªåŠ¨å¤„ç†è¿›ç¨‹æ­»äº¡ã€‚</p>
</blockquote>
<blockquote>
<p>å½“æŸä¸ªè¿›ç¨‹ <code>post</code> äº‹ä»¶æ—¶ï¼Œåªéœ€è¦é€šè¿‡ Binder æŠŠ <code>EventWrapper</code> å‘ç»™ Serviceï¼Œ<br>Service å† <strong>éå† callback åˆ—è¡¨ï¼Œå°†äº‹ä»¶ fan-out åˆ†å‘åˆ°å…¶ä»–è¿›ç¨‹</strong>ï¼Œç”±å„è¿›ç¨‹æœ¬åœ°å¤„ç†ã€‚</p>
</blockquote>
<blockquote>
<p>è¿™ç§è®¾è®¡é¿å…äº†è¿›ç¨‹ä¹‹é—´ç›´æ¥äº’è°ƒï¼Œ<strong>é™ä½è€¦åˆåº¦</strong>ï¼ŒåŒæ—¶å¯¹ WebView å¤šè¿›ç¨‹ã€æ’ä»¶åŒ–åœºæ™¯æ¯”è¾ƒå‹å¥½ã€‚</p>
</blockquote>
<p><strong>Qï¼šä¸ºä»€ä¹ˆä¸è®©ä¸»è¿›ç¨‹ç›´æ¥è°ƒ web è¿›ç¨‹ï¼Ÿ</strong></p>
<blockquote>
<p>ä¼šå½¢æˆ NÃ—N çš„ Binder ä¾èµ–ï¼Œç”Ÿå‘½å‘¨æœŸå’Œå¼‚å¸¸å¤„ç†éƒ½å¾ˆå¤æ‚ï¼Œç”¨ä¸­å¿ƒ Service å¯ä»¥ç»Ÿä¸€ç®¡ç†ã€‚</p>
</blockquote>
<p><strong>Qï¼šä¸ºä»€ä¹ˆç”¨ RemoteCallbackListï¼Ÿ</strong></p>
<blockquote>
<p>å®ƒèƒ½è‡ªåŠ¨æ„ŸçŸ¥è¿›ç¨‹æ­»äº¡å¹¶æ¸…ç† callbackï¼Œé¿å…å†…å­˜æ³„æ¼ï¼Œè¿™æ˜¯ Binder å›è°ƒçš„æœ€ä½³å®è·µã€‚</p>
</blockquote>
<p><em>æ€»ç»“æµç¨‹</em></p>
<ol>
<li>å®¢æˆ·ç«¯é€šè¿‡ AIDL æ³¨å†Œå›è°ƒæ¥å£ç»™æœåŠ¡ç«¯ï¼š<br><code>service.registerCallback(myCallback);</code></li>
<li>æœåŠ¡ç«¯å°†å›è°ƒä¿å­˜åˆ° <code>RemoteCallbackList</code>ã€‚</li>
<li>æœåŠ¡ç«¯éœ€è¦é€šçŸ¥å®¢æˆ·ç«¯æ—¶ï¼š<ul>
<li>éå† <code>RemoteCallbackList</code> â†’ è°ƒç”¨ <code>callback.call()</code></li>
</ul>
</li>
<li><code>RemoteCallbackList</code> è‡ªåŠ¨å¤„ç†æ­»æ‰çš„å®¢æˆ·ç«¯ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
</ol>
<p>call æ–¹æ³•æ˜¯ IProcessCallback çš„æ–¹æ³•ï¼ŒIProcessCallback è‡ªå·±å®šä¹‰çš„ï¼Œè°ƒç”¨ call å…¶å®å°±æ˜¯å®¢æˆ·ç«¯è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•ï¼Œç„¶åçœŸæ­£çš„æœåŠ¡ç«¯æ–¹æ³•æ‰§è¡Œ<br>aidl å‘é€çš„æ˜¯ JSON å­—ç¬¦ä¸²ï¼Œç„¶åè½¬æˆå¯¹åº”çš„å¯¹è±¡</p>
<p><img src="https://obsidian-yupic.oss-cn-beijing.aliyuncs.com/_resources/Binder_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.resources/2023/09/15/18-50-43-c8625b252f78ea946bc9408ae352c0e9-unknown_filename.9-dfbae2.png" srcset="/img/loading.gif" lazyload alt="unknown_filename.9|900"></p>
<h4 id="RemoteCallbackList"><a href="#RemoteCallbackList" class="headerlink" title="RemoteCallbackList"></a>RemoteCallbackList</h4><ul>
<li>åœ¨ Android å¤šè¿›ç¨‹ç¯å¢ƒä¸‹ï¼Œ<strong>å®¢æˆ·ç«¯å¯èƒ½æ³¨å†Œå¤šä¸ªå›è°ƒæ¥å£</strong>ï¼Œè€Œä¸”è¿™äº›å›è°ƒå¯¹è±¡å¯èƒ½è·¨è¿›ç¨‹ã€‚</li>
<li><strong><code>RemoteCallbackList</code></strong> æ˜¯ä¸“é—¨ç”¨æ¥ç®¡ç†è¿œç¨‹å›è°ƒçš„çº¿ç¨‹å®‰å…¨åˆ—è¡¨ã€‚</li>
<li>ä½œç”¨<ul>
<li>è‡ªåŠ¨å¤„ç†æ­»æ‰çš„è¿›ç¨‹ï¼ˆå½“å®¢æˆ·ç«¯è¿›ç¨‹é€€å‡ºï¼Œ<code>RemoteCallbackList</code> ä¼šè‡ªåŠ¨ç§»é™¤å›è°ƒï¼‰ã€‚</li>
<li>æä¾› <code>beginBroadcast()</code> å’Œ <code>finishBroadcast()</code> æ¥å®‰å…¨éå†å›è°ƒåˆ—è¡¨ã€‚</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">RemoteCallbackList&lt;IProcessCallback&gt; mCallbacks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteCallbackList</span>&lt;&gt;();<br><br><span class="hljs-comment">// æ³¨å†Œå›è°ƒ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCallback</span><span class="hljs-params">(IProcessCallback callback)</span> &#123;<br>    mCallbacks.register(callback);<br>&#125;<br><br><span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unregisterCallback</span><span class="hljs-params">(IProcessCallback callback)</span> &#123;<br>    mCallbacks.unregister(callback);<br>&#125;<br><br><span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰å®¢æˆ·ç«¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyClients</span><span class="hljs-params">(String message)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> mCallbacks.beginBroadcast();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mCallbacks.getBroadcastItem(i).call(message);<br>        &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>    mCallbacks.finishBroadcast();<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p> <code>callback.call()</code></p>
<ul>
<li>è¿™æ˜¯å®é™…è§¦å‘å›è°ƒçš„æ–¹æ³•ã€‚</li>
<li>å…³é”®ç‚¹ï¼š<ul>
<li>**å¯èƒ½æŠ›å‡º <code>RemoteException</code>**ï¼Œå› ä¸ºè·¨è¿›ç¨‹é€šä¿¡å¯èƒ½å¤±è´¥ã€‚</li>
<li>æ¯ä¸ª <code>callback</code> å¯¹è±¡éƒ½æ˜¯ <strong>è¿œç¨‹ä»£ç†</strong>ï¼Œè°ƒç”¨å®ƒä¼šè§¦å‘ IPC é€šä¿¡ã€‚</li>
<li>é€šå¸¸åœ¨ <code>RemoteCallbackList</code> éå†æ—¶ä½¿ç”¨ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ContentProvider"><a href="#ContentProvider" class="headerlink" title="ContentProvider"></a>ContentProvider</h3><p>ï¼ˆè¿›ç¨‹é—´æ•°æ®å…±äº«ï¼‰å’Œmessageä¸€æ ·ï¼Œåº•å±‚ä¹Ÿæ˜¯binderï¼Œé™¤äº†oncreateæ–¹æ³•å…¶ä»–æ–¹æ³•(crud)éƒ½æ˜¯è¿è¡Œåœ¨bindlerçº¿ç¨‹é‡Œã€‚æ‰€ä»¥åœ¨oncerateé‡Œä¸èƒ½åšè€—æ—¶æ“ä½œã€‚Androidæœ¬èº«å°±æä¾›äº†ä¸å°‘çš„ContentProviderè®¿é—®ï¼Œæ¯”å¦‚è”ç³»äººã€ç›¸å†Œç­‰ã€‚Â è®¿é—®ContentProviderï¼Œéœ€è¦é€šè¿‡Uriï¼Œéœ€è¦ä»¥â€œcontent:&#x2F;&#x2F;â€å¼€å¤´ã€‚åœ¨å…¶ä»–åº”ç”¨è®¿é—®é€šè¿‡uri(ä¸»æœºå)ï¼š</p>
<p>ç¼ºç‚¹ï¼šäº’ç›¸ä¼ é€’æ•°æ®éº»çƒ¦ï¼Œ2ä¸ªprovider</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4b04d50485ec">ContentProvider</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">contentResolver?.call(<br>          MainProcessContentProvider.MAINCONTENTPROVIDER_URI,<br>          <span class="hljs-string">&quot;getAge&quot;</span>,<br>          <span class="hljs-literal">null</span>,<br>          bundleOf(<span class="hljs-string">&quot;student&quot;</span> to <span class="hljs-string">&quot;å°ç±³&quot;</span>)<br>      )<br>    <br></code></pre></td></tr></table></figure>

<p>ä¸€èˆ¬çš„è·¨è¿›ç¨‹é€šä¿¡å°±æ˜¯åŸºäº aidlï¼Œè¿™ç§æ–¹å¼å­˜åœ¨çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªServiceï¼Œå†é€šè¿‡BindServiceæ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚ä¹Ÿèƒ½ç”¨ContentProvider.call()æ¥å®ç°ä¾¿æ·çš„è·¨è¿›ç¨‹é€šä¿¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br> <span class="hljs-keyword">public</span> Bundle <span class="hljs-title function_">call</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> String method, <span class="hljs-meta">@Nullable</span> String arg, <span class="hljs-meta">@Nullable</span> Bundle extras)</span> &#123;<br>     <span class="hljs-keyword">if</span> (!TextUtils.isEmpty(method) &amp;&amp; TextUtils.equals(method, <span class="hljs-string">&quot;setData&quot;</span>)) &#123;<br>         mBinderParcel.mProxy = extras.getBinder(<span class="hljs-string">&quot;binder&quot;</span>);<br>     &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!TextUtils.isEmpty(method) &amp;&amp; TextUtils.equals(method, <span class="hljs-string">&quot;getData&quot;</span>)) &#123;<br>         <span class="hljs-type">Bundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();<br>         bundle.putBinder(<span class="hljs-string">&quot;binder&quot;</span>, mBinderParcel.mProxy);<br>         <span class="hljs-keyword">return</span> bundle;<br>     &#125;<br>     <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br> &#125;<br>    <br></code></pre></td></tr></table></figure>

<p>methodå¯ä»¥ç”¨æ¥åŒºåˆ†è°ƒç”¨çš„é€»è¾‘ï¼Œargè²Œä¼¼æ²¡ä»€ä¹ˆç”¨ï¼Œextrasæ˜¯ä¸€ä¸ªBundleç±»å‹ç”¨æ¥å­˜æ”¾æ•°æ®ã€‚<br>è°ƒç”¨çš„æ—¶å€™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">getContentResolver().call(Uri.parse(<span class="hljs-string">&quot;content://com.example.mycontentprovider&quot;</span>), <span class="hljs-string">&quot;setData&quot;</span>, <span class="hljs-literal">null</span>, bundle); <span class="hljs-comment">//è®¾ç½®æ•°æ®</span><br><br><span class="hljs-type">Bundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> getContentResolver().call(Uri.parse(<span class="hljs-string">&quot;content://com.example.mycontentprovider&quot;</span>), <span class="hljs-string">&quot;getData&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><br>mBinder = IMyAidlInterface.Stub.asInterface(bundle.getBinder(<span class="hljs-string">&quot;binder&quot;</span>));<br><br>Log.i(<span class="hljs-string">&quot;kingiyu&quot;</span>, <span class="hljs-string">&quot;RemoteActivity--&gt;--&gt;onCreate--&gt;&quot;</span> + mBinder.getData());<br></code></pre></td></tr></table></figure>


<h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>[[2-Activityè¿›ç¨‹å¯åŠ¨æµç¨‹#ams-Zygote é€šä¿¡ä¸ºä»€ä¹ˆç”¨ Socket]]</p>
<h3 id="Messenger"><a href="#Messenger" class="headerlink" title="Messenger"></a>Messenger</h3><ol>
<li>é€šè¿‡Â Messengerè¿›è¡Œä¼ é€’ï¼ˆ<strong>handler</strong>ï¼‰ï¼Œåœ¨è¿œç¨‹æœåŠ¡é‡Œåˆ›å»ºhandlerï¼ˆæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼‰ã€Â Messengerå¯¹åƒï¼Œåœ¨onbindé‡Œè¿”å›(Â Messenger.getbinder)ã€‚åœ¨å®¢æˆ·ç«¯ç»‘å®šæœåŠ¡ï¼Œæ‹¿ç€Â Messengerå¯¹è±¡å‘æ¶ˆæ¯(å¯ä»¥ç”¨bundle)ã€‚åœ¨è¿œç¨‹æœåŠ¡çš„handlermessageæ–¹æ³•å°±ä¼šæ”¶åˆ°ã€‚ä»–æ˜¯ä¸€ä¸ªä¸ªå¤„ç†çš„ï¼Œå¦‚æœå¤§é‡å¹¶å‘è¯·æ±‚ç”¨aidlï¼ŒÂ Messengeråº•å±‚å°±æ˜¯aidl</li>
</ol>
<blockquote>
<p>åœ¨å®¢æˆ·ç«¯ä¸­åˆ›å»ºä¸€ä¸ªMessengerã€‚ç„¶åï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°Â onServiceConnected()Â å›è°ƒæ—¶ï¼Œä¼šå‘æœåŠ¡å‘é€ä¸€æ¡Â Messageï¼Œå¹¶åœ¨å…¶Â send()Â æ–¹æ³•çš„Â replyToÂ å‚æ•°ä¸­åŒ…å«å®¢æˆ·ç«¯çš„Â Messengerã€‚<br>æ³¨æ„ï¼šMessengerå’ŒMessageæ˜¯ä¿©ä¸ªä¸œè¥¿</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">(View v)</span> &#123;<br>	<span class="hljs-keyword">if</span> (!mBound) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> Message.obtain(<span class="hljs-literal">null</span>, MessengerService.MSG_SAY_HELLO, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>	<span class="hljs-keyword">try</span> &#123;<br>	   mService.send(msg);<br>	&#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>		e.printStackTrace();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ol start="2">
<li>ç›´æ¥ä½¿ç”¨Binderå¯¹è±¡ï¼šç¼ºç‚¹æ˜¯è¿™ç§æ–¹å¼ä¸èƒ½è¿›è¡Œè·¨è¿›ç¨‹ï¼Œè·¨åº”ç”¨ç¨‹åºçš„å‡½æ•°è°ƒç”¨ã€‚åªèƒ½å®ç°åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¹‹ä¸­ï¼ŒåŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¹‹ä¸­çš„ä¸åŒçš„ç»„ä»¶ä¹‹é—´é€šè®¯ã€‚</li>
</ol>
<blockquote>
<p>ç”¨æ³•ï¼šç»§æ‰¿Binderï¼Œç„¶ååœ¨serviceé‡Œreturn<br>ç»§æ‰¿Binderç”¨å®ƒçš„å¯¹è±¡è¿”å›ï¼Œå®¢æˆ·ç«¯å°†bindå¯¹è±¡å¼ºè½¬æˆè‡ªå®šä¹‰Bind</p>
</blockquote>
<h2 id="å†…å­˜æ³„éœ²"><a href="#å†…å­˜æ³„éœ²" class="headerlink" title="å†…å­˜æ³„éœ²"></a>å†…å­˜æ³„éœ²</h2><p>Binder ä»£ç†å¯¹è±¡æ³„éœ²é—®é¢˜</p>
<ol>
<li>è·¨è¿›ç¨‹å›è°ƒï¼šå½“ä¸€ä¸ªè¿›ç¨‹é€šè¿‡Binderå°†è‡ªå·±çš„ä»£ç†å¯¹è±¡ä¼ é€’ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­æ³¨å†Œå›è°ƒæ¥å£æ—¶ï¼Œå¦‚æœæ²¡æœ‰é€‚æ—¶åœ°å–æ¶ˆæ³¨å†Œæˆ–è§£é™¤å¼•ç”¨ï¼Œå°±ä¼šå¯¼è‡´æ³„éœ²ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªActivityé€šè¿‡Binderä¼ é€’è‡ªå·±çš„ä»£ç†å¯¹è±¡ç»™Serviceï¼Œå¹¶åœ¨Serviceä¸­æ³¨å†Œå›è°ƒæ¥å£ï¼Œ<em>å¦‚æœActivityé”€æ¯æ—¶æ²¡æœ‰å–æ¶ˆæ³¨å†Œï¼Œå°±ä¼šå¯¼è‡´Activityçš„ä»£ç†å¯¹è±¡æ— æ³•é‡Šæ”¾</em>ã€‚</li>
<li>è·¨è¿›ç¨‹å•ä¾‹æ¨¡å¼ï¼šå½“ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ç»„ä»¶ï¼ˆå¦‚Serviceæˆ–ContentProviderï¼‰é€šè¿‡Binderæä¾›å•ä¾‹å¯¹è±¡ç»™å…¶ä»–è¿›ç¨‹æ—¶ï¼Œå¦‚æœå…¶ä»–è¿›ç¨‹æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰é€‚æ—¶åœ°é‡Šæ”¾å¼•ç”¨ï¼Œå°±ä¼šå¯¼è‡´æ³„éœ²ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–è¿›ç¨‹å¯èƒ½ä¼šé•¿æ—¶é—´æŒæœ‰å¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿å¯¹è±¡æ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚</li>
<li>è·¨è¿›ç¨‹æ•°æ®ç¼“å­˜ï¼š<em>å½“ä¸€ä¸ªè¿›ç¨‹é€šè¿‡Binderå°†æ•°æ®æä¾›ç»™å…¶ä»–è¿›ç¨‹ï¼Œå¹¶ä¸”å…¶ä»–è¿›ç¨‹æŒæœ‰æ•°æ®çš„å¼•ç”¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰é€‚æ—¶åœ°é‡Šæ”¾å¼•ç”¨</em>ï¼Œå°±ä¼šå¯¼è‡´æ³„éœ²ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®å¯¹è±¡å¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li>
</ol>
<p>ä¸ºé¿å…Binderä»£ç†å¯¹è±¡æ³„éœ²é—®é¢˜ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p>
<ol>
<li>ç¡®ä¿åœ¨ä¸å†éœ€è¦Binderä»£ç†å¯¹è±¡æ—¶åŠæ—¶è§£é™¤å¼•ç”¨æˆ–å–æ¶ˆæ³¨å†Œå›è°ƒæ¥å£ï¼Œé¿å…é•¿æ—¶é—´æŒæœ‰ä»£ç†å¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li>åœ¨ä½¿ç”¨Binderè¿›è¡Œè·¨è¿›ç¨‹é€šä¿¡æ—¶ï¼Œéµå¾ªè‰¯å¥½çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†åŸåˆ™ï¼Œç¡®ä¿åœ¨åˆé€‚çš„æ—¶æœºé‡Šæ”¾èµ„æºã€‚</li>
<li>å¯¹äºè·¨è¿›ç¨‹ä¼ é€’çš„æ•°æ®å¯¹è±¡ï¼Œå°½é‡é¿å…é•¿æ—¶é—´æŒæœ‰å¼•ç”¨ï¼Œæˆ–è€…ä½¿ç”¨å¼±å¼•ç”¨ç­‰æœºåˆ¶æ¥ç®¡ç†å¼•ç”¨ã€‚</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%BA%90%E7%A0%81/" class="category-chain-item">æºç </a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>å¤šè¿›ç¨‹Binder</div>
      <div>http://peiniwan.github.io/2025/12/d842c8b35664.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>å…­æœˆçš„é›¨</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2025å¹´12æœˆ16æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/12/7efc84cd0a08.html" title="æ•°æ®å­˜å‚¨">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">æ•°æ®å­˜å‚¨</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/12/96e9a68a331d.html" title="SparseArray å’Œ ArrayMap">
                        <span class="hidden-mobile">SparseArray å’Œ ArrayMap</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"OwNIdaopOn1rwNhtotGOGC0B-gzGzoHsz","appKey":"eadytQ2XqWmxuvAKeg08XX83","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":false,"serverURLs":"https://ownidaop.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
